<!DOCTYPE html>
<html lang="id">

<head>
  <style>
    body {
      margin: 0;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
</head>

<body>
  <script>
    const socket = io('http://localhost:4000')

    const animation = [
      {left: '100vw'},
      {left: '-100vw'},
    ]
    socket.on('connect', () => {
      socket.emit("register", "flyavatar")
    })
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const factor = 10
    const va = vh - (vw * factor / 100)

    socket.on("fly", data => {
      let div = document.createElement('div')
      div.style = `
        opacity: 1;
        position: absolute;
        left: 100vw;
        top: ${Math.random() * va}px;
        width: ${factor}vw;
        aspect-ratio: 1 / 1;
        transform: translate(0, 0);
      `
      let heartImg = document.createElement('img')
      heartImg.src = './heart.webp'
      heartImg.style = `
        position: absolute;
        width: 25%;
        height: 25%;
        top: 0;
        left: 0;
      `
      let img = document.createElement('img')
      img.src = data.imageUrl
      img.style = `
        width: 100%;
        height: 100%;
        border-radius: 50%;
      `

      div.appendChild(img)
      div.appendChild(heartImg)
      document.body.appendChild(div)

      let flying = div.animate(
        animation,
        {
          fill: "both",
          duration: 10000,
          iteration: 1,
        }
      )
      flying.onfinish = () => {
        document.body.removeChild(div)
      }
    })
  </script>
</body>

</html>
